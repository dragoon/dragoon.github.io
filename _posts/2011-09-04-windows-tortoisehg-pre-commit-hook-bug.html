---
layout: post
title: "Windows TortoiseHg pre-commit hook bug"
date: 2011-09-04
comments: false
categories:
 - mercurial
 - hook
 - bug
 - hghooks
 - hg
 - tortoisehg
---

<div class='post'>
Пост о баге, с которым можно столкнуться при настройке хуков в <b>mercurial</b>, работая с клиентом <a href="http://tortoisehg.bitbucket.org/">TortoiseHg</a> под Windows.<br /><br />Итак, я настраивал хуки в <b>mercurial</b> для автоматической проверки python-кода с помощью пакета <a href="http://pypi.python.org/pypi/hghooks/">hghooks</a>. Данный пакет содержит готовые хуки для провеки кода на соответствие PEP8 и с помощью анализатора <a href="http://pypi.python.org/pypi/pyflakes">pyflakes</a>.<br /><br />В документации предлагается просто добавить к конфиг <b>mercurial</b> (hgrc, mercurial.ini) следующие строки:<br /><pre style="background-color: #eeeeee; border: 1px dashed; margin: 0; padding: 5px;">[hooks]<br />pretxncommit.pep8 = python:hghooks.code.pep8hook<br />pretxncommit.pyflakes = python:hghooks.code.pyflakeshook<br />pretxncommit.pdb = python:hghooks.code.pdbhook</pre><pre></pre><br />Однако в моём случае после этой настройки комит вылетел с ошибкой вида: <br /><pre style="background-color: #eeeeee; border: 1px dashed; margin: 0; padding: 5px;">abort: pretxncommit.pep8 hook is invalid (import of "hghooks.code" failed)</pre><pre></pre><br />Дело в том, что клиент <b>TortoiseHg </b> не умеет использовать никакие установленные библиотеки кроме тех из файла <b>library.zip</b>, расположенного по умолчанию в <b>c:\Program Files\TortoiseHg\</b>. Поэтому для устранения ошибки надо добавить в архив каталоги <b>hghooks</b>, <b>pyflakes </b>и файл <b>pep8.py</b>. </div>
